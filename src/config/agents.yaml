# SubAgent and Tool Configuration
# This file defines which SubAgents and Tools are enabled and their settings

# =============================================================================
# Planning Mode Configuration
# =============================================================================
planning:
  # Enable dynamic mode for ad-hoc agent generation
  # When true: Planner analyzes tools and creates ad-hoc agents as needed
  # When false: Only uses pre-defined agents (simple mode)
  dynamic_mode: true

  # Prefer template agents when they match the task
  # If false, always generate ad-hoc agents even when templates exist
  prefer_templates: true

# =============================================================================
# Template Agents (Pre-defined agent patterns)
# These are well-tested agent configurations that can be reused
# =============================================================================
template_agents:
  # Comprehensive search template - searches both knowledge base and vectors
  comprehensive_search:
    enabled: true
    description: "包括的な検索を実行（ナレッジベース + ベクトル検索）"
    purpose: "ユーザーの質問に対して、複数のソースから情報を収集"
    capabilities:
      - knowledge_search
      - semantic_search
    tools:
      - servicenow_knowledge_search
      - vector_db_search
    parallel_execution: true
    expected_output: "複数ソースからの検索結果とその関連度"

  # IT support template - specialized for IT issues
  it_support:
    enabled: true
    description: "IT問題のトラブルシューティング"
    purpose: "IT関連の問題を診断し、解決策を提示"
    capabilities:
      - troubleshooting
      - case_search
    tools:
      - servicenow_knowledge_search
      - servicenow_case_search
    parallel_execution: false
    expected_output: "問題の診断結果と推奨される解決手順"

  # Service request template - for finding the right service
  service_request:
    enabled: true
    description: "適切なサービス申請先を特定"
    purpose: "ユーザーのニーズに合ったサービスカタログアイテムを見つける"
    capabilities:
      - catalog_search
      - recommendation
    tools:
      - catalog_list
      - catalog_detail
    parallel_execution: false
    expected_output: "推奨されるサービスカタログアイテムと申請手順"

# =============================================================================
# Static SubAgents (Python class implementations)
# These are the original pre-defined agents
# =============================================================================
sub_agents:
  knowledge_search:
    enabled: true
    description: "ServiceNow公式ナレッジベースを検索"
    capabilities:
      - knowledge_search
      - case_search
    max_retries: 2
    retry_strategy:
      retry_conditions:
        - no_results
      query_modification: synonym
      backoff_seconds: 0.5
    tools:
      - servicenow_knowledge_search
      - servicenow_case_search

  vector_search:
    enabled: true
    description: "事前構築済みナレッジのベクトル検索"
    capabilities:
      - semantic_search
      - similarity_search
    max_retries: 3
    retry_strategy:
      retry_conditions:
        - no_results
        - low_relevance
      query_modification: llm_rewrite
      backoff_seconds: 0.5
    tools:
      - vector_db_search

  catalog:
    enabled: true
    description: "ServiceNowカタログから適切な申請先を調査"
    capabilities:
      - catalog_search
      - catalog_recommendation
    max_retries: 1
    retry_strategy:
      retry_conditions: []
      query_modification: none
      backoff_seconds: 0
    tools:
      - catalog_list
      - catalog_detail

# =============================================================================
# Tools Configuration
# =============================================================================
tools:
  servicenow_knowledge_search:
    enabled: true
    description: "ServiceNowのナレッジベースを検索します"
    category: search
    required_service_token: servicenow
    timeout_seconds: 30

  servicenow_case_search:
    enabled: true
    description: "ServiceNowのケース（チケット）を検索します"
    category: search
    required_service_token: servicenow
    timeout_seconds: 30

  servicenow_table_detail:
    enabled: true
    description: "ServiceNowテーブルの詳細情報を取得します"
    category: data
    required_service_token: servicenow
    timeout_seconds: 30

  vector_db_search:
    enabled: true
    description: "事前構築済みナレッジをセマンティック検索します"
    category: search
    required_service_token: vector_db
    timeout_seconds: 30
    settings:
      default_top_k: 5
      default_threshold: 0.7

  catalog_list:
    enabled: true
    description: "ServiceNowサービスカタログの一覧を取得します"
    category: catalog
    required_service_token: servicenow
    timeout_seconds: 30

  catalog_detail:
    enabled: true
    description: "ServiceNowサービスカタログの詳細情報を取得します"
    category: catalog
    required_service_token: servicenow
    timeout_seconds: 30

# =============================================================================
# Execution Settings
# =============================================================================
execution:
  parallel_timeout_seconds: 30
  sub_agent_timeout_seconds: 60
  tool_timeout_seconds: 30

  # Maximum number of ad-hoc agents that can be created in a single plan
  max_adhoc_agents: 5

  # Maximum number of tools an ad-hoc agent can use
  max_tools_per_adhoc_agent: 4

# =============================================================================
# Default Parallel Execution Groups
# These define which agents can run in parallel by default
# =============================================================================
parallel_groups:
  search_phase:
    agents:
      - knowledge_search
      - vector_search
    timeout_seconds: 30
